import os, shutil
from typing import List
from .joern_server import *
from .joern_parser import *
from config import tc_path, td_path


def move_singlefile_to_tmpdir() -> None:
    if not os.path.exists(td_path):
        os.mkdir(td_path)
    for obj in os.listdir(tc_path):
        obj_dir = os.path.join(tc_path, obj)
        if os.path.isfile(obj_dir):
            shutil.move(obj_dir, td_path)


def parse() -> None:
    move_singlefile_to_tmpdir()         # 将单一的代码文件移动到临时文件夹中，后续的解析过程将一个文件夹内的所有内容视为一个单独的项目

    client = start_joern_server()       # 对指定文件夹中的所有项目进行解析
    parse_testcase(client)              # 从解析好的CPG（代码属性图）中提取出想要的信息
    kill_server()                       # 关闭joern服务器进程
