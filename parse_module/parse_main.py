import os, shutil
from typing import List
from .joern_server import *
from .joern_parser import *
from config import tc_path, td_path


def move_singlefile_to_tmpdir() -> None:
    """move single file to tmpdir,and keep on the other project dir"""
    if not os.path.exists(td_path):             # 新建一个tmp文件夹
        os.mkdir(td_path)
    for obj in os.listdir(tc_path):             # 遍历testcase2中每个项目文件(夹)
        obj_dir = os.path.join(tc_path, obj)
        if os.path.isfile(obj_dir):             # 将单一文件移动到tmp中，文件夹保留
            shutil.move(obj_dir, td_path)


def parse() -> None:
    move_singlefile_to_tmpdir()

    client = start_joern_server()           # 新建joern客户端，解析文件
    parse_testcase(client)                  # 获取所需数据
    kill_server()
